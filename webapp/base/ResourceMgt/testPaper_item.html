
<!--查询试卷-->
<div id="vue">
    <div style="text-align: center;">
        <h2>{{paperVo.title}}</h2>
    </div>



    <div style="text-align: center;">
        <div class="mdui-col-xs-10" >
            <span>学年：{{paperVo.schoolYearStr}}</span>
            <span>年级：{{paperVo.gradeCodeStr}}</span>
            <span>年份：{{paperVo.paperYearStr}}</span>
            <span>时长：{{paperVo.timeSpan}}</span>
            <span>总分：{{paperVo.score}}</span>
        </div>
        <div class="mdui-col-xs-2" >
            <span><a href="###" onclick="back()">返回</a></span>
        </div>

    </div>



    <div id="sort" style="padding-top: 50px">
        <div v-for="(alPaperElement,index) in alPaperElementList" v-bind:elementid="alPaperElement.elementId">

            <div v-if="alPaperElement.elementType == 'TEM'">
                <!------------------------------------------段落------------------------------------------->
                <div class="doc-container">
                    <div class="doc-example">
                        <div class="doc-example-demo-label">
                            编辑
                        </div>

                        <div class="doc-example-demo">
                            <!--内容-->
                            {{index+1}}<span v-html="alPaperElement.elementDesc"></span>

                        </div>
                        <div class="doc-example-code">
                            <!--编辑-->
                            <div>
                                <textarea type="text" v-model="alPaperElement.elementDesc"></textarea>（<a href="###" v-on:click="openUmeditor(alPaperElement,'elementDesc')">高级模式</a>）
                            </div>
                            <div>
                                <a href="###" v-on:click="saveElement(alPaperElement,index)">完成编辑</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div v-if="alPaperElement.elementType == 'ITP'">
                <!--题目-->
                <div v-if="alPaperElement.itpType == 'ZHUGUAN'">
                    <!-------------------------------------主观题------------------------------------->
                    <div class="doc-container">
                        <div class="doc-example">
                            <div class="doc-example-demo-label">
                                编辑
                            </div>

                            <div class="doc-example-demo">
                                <!--内容-->
                                <div >
                                    {{index+1}}<span v-html="alPaperElement.content"></span>[主观题]（{{alPaperElement.score}}分）
                                </div>
                                <div>
                                    <a href="###" v-on:click="addObjectId(alPaperElement,index)">覆盖目标({{alPaperElement.objectId == null || alPaperElement.objectId == ''?0:1}})</a>
                                </div>
                                <div >
                                    <span v-html="alPaperElement.correctResponse"></span>
                                </div>
                            </div>
                            <div class="doc-example-code">
                                <!--编辑-->
                                <div>
                                    <select v-model="alPaperElement.score">
                                        <option value="0.5">0.5分</option>
                                        <option v-for="i in 50" v-bind:value="i">{{i}}分</option>
                                    </select>
                                </div>
                                <div>
                                    <div>*题干</div>
                                    <div><textarea type="text" v-model="alPaperElement.content"></textarea>（<a href="###" v-on:click="openUmeditor(alPaperElement,'content')">高级模式</a>）（<a href="###" v-on:click="openUpload(alPaperElement)">附件</a>）</div>

                                </div>
                                <div>
                                    <div>*答案</div>
                                    <div>
                                        <textarea v-model="alPaperElement.correctResponse"></textarea>（<a href="###" v-on:click="openUmeditor(alPaperElement,'correctResponse')">高级模式</a>）
                                    </div>
                                    <div>*解析</div>
                                    <div>
                                        <textarea v-model="alPaperElement.howTo"></textarea>（<a href="###" v-on:click="openUmeditor(alPaperElement,'howTo')">高级模式</a>）
                                    </div>
                                    <div>
                                        覆盖目标:
                                    </div>
                                    <div>
                                        <a href="###" v-on:click="saveElement(alPaperElement,index)">完成编辑</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <div v-if="alPaperElement.itpType == 'DANXUAN'">
                    <!-------------------------------------单选题------------------------------------->
                    <div class="doc-container">
                        <div class="doc-example">
                            <div class="doc-example-demo-label">
                                编辑
                            </div>

                            <div class="doc-example-demo">
                                <!--内容-->
                                <div >
                                    {{index+1}}<span v-html="alPaperElement.content"></span>[单选题]（{{alPaperElement.score}}分）
                                </div>
                                <div>
                                    <a href="###" v-on:click="addObjectId(alPaperElement,index)">覆盖目标({{alPaperElement.objectId == null || alPaperElement.objectId == ''?0:1}})</a>
                                </div>
                                <div >
                                    <div v-if="alPaperElement.layout == '1*'">
                                        <span v-for="(answer,cindex) in alPaperElement.answer" v-bind:style="alPaperElement.choiceId == answer.choiceId ? 'color:green' : '' " >
                                                {{ABC[cindex]}}<span v-html="answer.content"></span>
                                        </span>
                                    </div>
                                    <div v-if="alPaperElement.layout != '1*'">
                                        <div v-for="(answer,cindex) in alPaperElement.answer">
                                            <span v-bind:style="alPaperElement.choiceId == answer.choiceId ? 'color:green' : '' " >
                                                {{ABC[cindex]}}<span v-html="answer.content"></span>
                                            </span>
                                        </div>
                                    </div>

                                </div>
                            </div>
                            <div class="doc-example-code">
                                <!--编辑-->
                                <div>
                                    <select v-model="alPaperElement.score">
                                        <option value="0.5">0.5分</option>
                                        <option v-for="i in 50" v-bind:value="i">{{i}}分</option>
                                    </select>
                                </div>
                                <div>
                                    <div>*题干</div>
                                    <div><textarea type="text" v-model="alPaperElement.content"></textarea>（<a href="###" v-on:click="openUmeditor(alPaperElement,'content')">高级模式</a>）</div>
                                </div>
                                <div>
                                    <div>*选项</div>
                                    <div>
                                        <div v-for="(answer,cindex) in alPaperElement.answer" class="choice">
                                            <input type="radio" v-bind:value="answer.choiceId" v-bind:checked="answer.isRight == '1'" v-model="alPaperElement.choiceId">
                                            {{ABC[cindex]}}
                                            <span>
                                                <input type="text" v-model="answer.content"><a href="###" v-on:click="deleteChoice(cindex,alPaperElement.answer,'DANXUAN',answer.choiceId)">删除</a>
                                                <a href="###" v-on:click="zIndexUp(alPaperElement.answer,cindex,alPaperElement.answer.length)">上移</a>
                                                <a href="###" v-on:click="zIndexDown(alPaperElement.answer,cindex,alPaperElement.answer.length)">下移</a>
                                                （<a href="###" v-on:click="openUmeditor(answer,'content')">高级模式</a>）
                                            </span>
                                        </div>
                                    </div>
                                    <div>
                                        <a href="###" v-on:click="addChoice(alPaperElement)">增加选项</a>
                                        <select v-model="alPaperElement.layout">
                                            <option value="1*">横向排列</option>
                                            <option value="*1">纵向排列</option>
                                        </select>
                                        <select v-model="alPaperElement.seqNoSure">
                                            <option value="0">随机排列</option>
                                            <option value="1">固定排列</option>
                                        </select>
                                    </div>
                                    <div>*解析</div>
                                    <div>
                                        <textarea v-model="alPaperElement.howTo"></textarea>（<a href="###" v-on:click="openUmeditor(alPaperElement,'howTo')">高级模式</a>）
                                    </div>
                                    <div>
                                        覆盖目标:
                                    </div>
                                    <div>
                                        <a href="###" v-on:click="saveElement(alPaperElement,index)">完成编辑</a>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>

                </div>

                <div v-if="alPaperElement.itpType == 'DUOXUAN'">
                    <!-------------------------------------多选题------------------------------------->
                    <div class="doc-container">
                        <div class="doc-example">
                            <div class="doc-example-demo-label">
                                编辑
                            </div>

                            <div class="doc-example-demo">
                                <!--内容-->
                                <div >
                                    {{index+1}}<span v-html="alPaperElement.content"></span>[多选题]（{{alPaperElement.score}}分）
                                </div>
                                <div>
                                    <a href="###" v-on:click="addObjectId(alPaperElement,index)">覆盖目标({{alPaperElement.objectId == null || alPaperElement.objectId == ''?0:1}})</a>
                                </div>
                                <div >
                                    <div v-if="alPaperElement.layout == '1*'">
                                        <span v-for="(answer,cindex) in alPaperElement.answer" v-bind:style="alPaperElement.choiceIdList.indexOf(answer.choiceId)>-1 ? 'color:green' : '' " >
                                                {{ABC[cindex]}}<span v-html="answer.content"></span>
                                        </span>
                                    </div>
                                    <div v-if="alPaperElement.layout != '1*'">
                                        <div v-for="(answer,cindex) in alPaperElement.answer">
                                            <span v-bind:style="alPaperElement.choiceIdList.indexOf(answer.choiceId)>-1 ? 'color:green' : '' " >
                                                {{ABC[cindex]}}<span v-html="answer.content"></span>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="doc-example-code">
                                <!--编辑-->
                                <div>
                                    <select v-model="alPaperElement.score">
                                        <option value="0.5">0.5分</option>
                                        <option v-for="i in 50" v-bind:value="i">{{i}}分</option>
                                    </select>
                                </div>
                                <div>
                                    <div>*题干</div>
                                    <div><textarea type="text" v-model="alPaperElement.content"></textarea>（<a href="###" v-on:click="openUmeditor(alPaperElement,'content')">高级模式</a>）</div>
                                </div>
                                <div>
                                    <div>*选项</div>
                                    <div>
                                        <div v-for="(answer,cindex) in alPaperElement.answer">
                                            <input type="checkbox" v-bind:value="answer.choiceId" v-bind:checked="answer.isRight == '1'" v-model="alPaperElement.choiceIdList">
                                            {{ABC[cindex]}}
                                            <span>
                                                <input type="text" v-model="answer.content"><a href="###" v-on:click="deleteChoice(cindex,alPaperElement.answer,'DUOXUAN',answer.choiceId)">删除</a>
                                                <a href="###" v-on:click="zIndexUp(alPaperElement.answer,cindex,alPaperElement.answer.length)">上移</a>
                                                <a href="###" v-on:click="zIndexDown(alPaperElement.answer,cindex,alPaperElement.answer.length)">下移</a>
                                                （<a href="###" v-on:click="openUmeditor(answer,'content')">高级模式</a>）
                                            </span>
                                        </div>
                                    </div>
                                    <div>
                                        <a href="###" v-on:click="addChoice(alPaperElement)">增加选项</a>
                                        <select v-model="alPaperElement.layout">
                                            <option value="1*">横向排列</option>
                                            <option value="*1">纵向排列</option>
                                        </select>
                                        <select v-model="alPaperElement.seqNoSure">
                                            <option value="0">随机排列</option>
                                            <option value="1">固定排列</option>
                                        </select>
                                    </div>
                                    <div>*解析</div>
                                    <div>
                                        <textarea v-model="alPaperElement.howTo"></textarea>（<a href="###" v-on:click="openUmeditor(alPaperElement,'howTo')">高级模式</a>）
                                    </div>
                                    <div>
                                        覆盖目标:
                                    </div>
                                    <div>
                                        <a href="###" v-on:click="saveElement(alPaperElement,index)">完成编辑</a>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>

                </div>

                <div v-if="alPaperElement.itpType == 'TIANKONG'">
                    <!-------------------------------------填空题------------------------------------->
                    <div class="doc-container">
                        <div class="doc-example">
                            <div class="doc-example-demo-label">
                                编辑
                            </div>

                            <div class="doc-example-demo">
                                <!--内容-->
                                <div>
                                    {{index+1}}<span v-html="alPaperElement.content"></span>[填空题]（{{alPaperElement.score}}分）
                                </div>
                                <div>
                                    <a href="###" v-on:click="addObjectId(alPaperElement,index)">覆盖目标({{alPaperElement.objectId == null || alPaperElement.objectId == ''?0:1}})</a>
                                </div>
                                <div >
                                    <div v-for="(answer,cindex) in alPaperElement.answer">
                                        <span >
                                            空{{cindex+1}}:<span v-html="answer.correctResponse"></span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="doc-example-code">
                                <!--编辑-->
                                <div>
                                    <select v-model="alPaperElement.score">
                                        <option value="0.5">0.5分</option>
                                        <option v-for="i in 50" v-bind:value="i">{{i}}分</option>
                                    </select>
                                </div>
                                <div>
                                    <div>*题干</div>
                                    <div><textarea type="text" v-model="alPaperElement.content" v-on:change="changeTianKongContent(alPaperElement)"></textarea>（<a href="###" v-on:click="openUmeditor(alPaperElement,'content')">高级模式</a>）</div>
                                </div>
                                <div>
                                    <div>*答案</div>
                                    <div>
                                        <div v-for="(answer,cindex) in alPaperElement.answer">
                                            权重：<input type="text" v-model="answer.weight">
                                            空格长度：<input type="text" v-model="answer.blankLength">
                                            答案：<input type="text" v-model="answer.correctResponse">
                                            （<a href="###" v-on:click="openUmeditor(answer,'correctResponse')">高级模式</a>）
                                            <!--<a href="###" v-on:click="deleteChoice(cindex,alPaperElement.answer,'TIANKONG',answer.blankId)">删除</a>-->
                                        </div>
                                    </div>
                                    <div>
                                        <a href="###" v-on:click="addBlank(alPaperElement)">增加填空（最小三个_）</a>
                                    </div>
                                    <div>*解析</div>
                                    <div>
                                        <textarea v-model="alPaperElement.howTo"></textarea>（<a href="###" v-on:click="openUmeditor(alPaperElement,'howTo')">高级模式</a>）
                                    </div>
                                    <div>
                                        覆盖目标:
                                    </div>
                                    <div>
                                        <a href="###" v-on:click="saveElement(alPaperElement,index)">完成编辑</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

            </div>

            <div style="display:inline-block;">
                <i class="mdui-icon material-icons" title="按住拖动排序">sort</i>
                <a href="###" class="viewsource" >编辑</a>
                <a href="###" v-on:click="deleteElement(index,alPaperElement)">删除</a>
            </div>

            <div class="mdui-divider" style="margin:5px"></div>
        </div>
    </div>


    <!--------------------------------------------------底部------------------------------------------->
    <div class="mdui-bottom-nav mdui-bottom-nav-text-auto  mdui-color-indigo">
        <a href="###" class="mdui-ripple mdui-ripple-white " v-on:click="addDanxuan()">单选</a>
        <a href="###" class="mdui-ripple mdui-ripple-white " v-on:click="addDuoxuan()">多选</a>
        <a href="###" class="mdui-ripple mdui-ripple-white " v-on:click="addTianKong()">填空</a>
        <a href="###" class="mdui-ripple mdui-ripple-white " v-on:click="addZhuGuan()">主观</a>
        <a href="###" class="mdui-ripple mdui-ripple-white " v-on:click="addTem()">段落</a>

        <a href="###" class="mdui-ripple mdui-ripple-white ">预览</a>
        <a href="###" class="mdui-ripple mdui-ripple-white ">发布</a>
    </div>

</div>





<script>
    var vm = new Vue({
                         el:"#vue",
                         data : {
                             paperVo:{
                                 paperType:'paperType.XUEQI',
                                 subjectCode:'subject.czsx',
                                 schoolYear:'',
                                 schoolYearStr:'',
                                 termCode:'',
                                 province:'',
                                 city:'',
                                 county:'',
                                 title:'',
                                 gradeCode:'',
                                 gradeCodeStr:'',
                                 paperYear:'',
                                 paperYearStr:'',
                                 paperId:''
                             },
                             // 元素list
                             alPaperElementList:[],

                             alPaperElementVO:{
                                 paperId:''
                             },
                             // 答案的abc
                             ABC:[
                                 'A : ','B : ','C : ','D : ' ,'E : ','F : ','G : '
                             ],
                             choice:{
                                 content:'',
                             },


                         },
                         created(){
                             // this.defaultUserData  = JSON.parse(JSON.stringify(this.userForm));
                         },
                         // 初始化执行
                         mounted(){
                             //this.listUserList()
                         },
                         //执行某些方法后数据产生了变化再执行
                         updated:function () {

                         },
                         // 数据发生变化之后进行监听，再执行
                         watch:{
                             //初始化获取数据后，对数据进行监听，发现propertyGroup数据已经加载，默认选中第一个，获取属性值

                         },
                         methods : {
                             list:function () {
                                 $.ajax({
                                            type : "post",
                                            url : projectName + "/engin/alPaperElement/list",
                                            data : JSON.stringify(vm.alPaperElementVO),
                                            datatype : 'json',
                                            contentType:"application/json",
                                            async: false,
                                            success : function(data) {
                                                //console.log(JSON.stringify(data))
                                                if(data.success == true){
                                                    vm.alPaperElementList = data.obj;
                                                }else{
                                                    $.dialog.alert(data.message,function(){});
                                                }
                                            },
                                            error : function() {
                                                $.dialog.alert('请求失败！',function(){});
                                            }
                                        });
                             },
                             // 完成某个编辑的保存
                             saveElement:function (alPaperElement,index) {
                                 console.log(JSON.stringify(alPaperElement));
                                 $.ajax({
                                            type : "post",
                                            url : projectName + "/engin/alPaperElement/save",
                                            data : JSON.stringify(alPaperElement),
                                            datatype : 'json',
                                            contentType:"application/json",
                                            async: false,
                                            success : function(data) {
                                                //console.log(JSON.stringify(data))
                                                if(data.success == true){
                                                    // 重新赋值
                                                    Vue.set( vm.alPaperElementList, index, data.obj );
                                                    $.dialog.alert(data.message,function(){});
                                                }else{
                                                    $.dialog.alert(data.message,function(){});
                                                }
                                            },
                                            error : function() {
                                                $.dialog.alert('请求失败！',function(){});
                                            }
                                        });
                             },
                             // 删除某个选项
                             deleteChoice:function (index,list,itpType,id) {
                                 if(id.indexOf('new_')> -1){
                                     list.splice(index, 1);
                                 }else{
                                     var obj = {};
                                     obj.itpType = itpType;
                                     obj.id = id;
                                     $.ajax({
                                                type : "post",
                                                url : projectName + "/engin/alItp/deleteChoice",
                                                data : JSON.stringify(obj),
                                                datatype : 'json',
                                                contentType:"application/json",
                                                async: false,
                                                success : function(data) {
                                                    //console.log(JSON.stringify(data))
                                                    if(data.success == true){
                                                        // 删除
                                                        list.splice(index, 1);
                                                        $.dialog.alert(data.message,function(){});
                                                    }else{
                                                        $.dialog.alert(data.message,function(){});
                                                    }
                                                },
                                                error : function() {
                                                    $.dialog.alert('请求失败！',function(){});
                                                }
                                            });

                                 }

                             },
                             // 添加某个选项
                             addChoice:function(alPaperElement){
                                 alPaperElement.answer.push({content:'',itemId:alPaperElement.itemId,choiceId:'new_'+new Date().getTime()});
                             },
                             // 添加某个空格
                             addBlank:function(alPaperElement){
                                 alPaperElement.content = alPaperElement.content + " ___ ";
                                 alPaperElement.answer.push({itemId:alPaperElement.itemId,blankId:'new_'+new Date().getTime(),blankType:'write',blankLength:'5',correctResponse:'',weight:'10'});
                             },
                             // 监听填空的内容变化
                             changeTianKongContent:function(alPaperElement){
                                 // 正则表达式
                                 var size = alPaperElement.content.split(/_{3,}/).length-1;
                                 if(size ==  alPaperElement.answer.length){

                                 }else{
                                     // 添加或者减少填空
                                     var c = size - alPaperElement.answer.length;
                                     if(c > 0){
                                         for(var i=0;i<c;i++){
                                             alPaperElement.answer.push({itemId:alPaperElement.itemId,blankId:'new_'+new Date().getTime(),blankType:'write',blankLength:'5',correctResponse:'',weight:'10'});
                                         }
                                     }else{
                                         c = 0 - c;
                                         for(var i=0;i<c;i++){
                                             vm.deleteChoice(alPaperElement.answer.length-1,alPaperElement.answer,"TIANKONG",alPaperElement.answer[alPaperElement.answer.length-1].blankId);
                                         }
                                     }
                                 }
                             },
                             // 选项的上移
                             zIndexUp:function (arr,index,length) {
                                 zIndexUp(arr,index,length);
                             },
                             // 选项的下移
                             zIndexDown:function (arr,index,length) {
                                 zIndexDown(arr,index,length);
                             },
                             // 添加一个段落
                             addTem:function () {
                                 vm.alPaperElementList.push({
                                                                elementId:'',
                                                                elementType:'TEM',
                                                                elementDesc:'',
                                                                paperId:vm.alPaperElementVO.paperId,
                                                                seqNo:vm.alPaperElementList.length+1
                                                         });
                             },
                             // 添加一个单选
                             addDanxuan:function () {
                                 vm.alPaperElementList.push({
                                                                elementId:'',
                                                                elementType:'ITP',
                                                                paperId:vm.alPaperElementVO.paperId,
                                                                seqNo:vm.alPaperElementList.length+1,
                                                                // 单选用
                                                                choiceId:'',
                                                                content:'',
                                                                howTo:'',
                                                                itemId:'',
                                                                itpType:'DANXUAN',
                                                                layout:'1*',
                                                                objectId:'',
                                                                objectStr:'',
                                                                publishStatus:'0',
                                                                score:'1',
                                                                seqNoSure:'1',
                                                                // targetId是itpId
                                                                targetId:'',
                                                                // 答案
                                                                answer:[],

                                                         });
                             },
                             // 添加一个多选
                             addDuoxuan:function () {
                                 vm.alPaperElementList.push({
                                                                elementId:'',
                                                                elementType:'ITP',
                                                                paperId:vm.alPaperElementVO.paperId,
                                                                seqNo:vm.alPaperElementList.length+1,
                                                                // 多选用
                                                                choiceIdList:[],
                                                                content:'',
                                                                howTo:'',
                                                                itemId:'',
                                                                itpType:'DUOXUAN',
                                                                layout:'1*',
                                                                objectId:'',
                                                                objectStr:'',
                                                                publishStatus:'0',
                                                                score:'1',
                                                                seqNoSure:'1',
                                                                // targetId是itpId
                                                                targetId:'',
                                                                // 答案
                                                                answer:[],

                                                            });
                             },
                             // 添加主观题
                             addZhuGuan:function () {
                                 vm.alPaperElementList.push({
                                                                elementId:'',
                                                                elementType:'ITP',
                                                                paperId:vm.alPaperElementVO.paperId,
                                                                seqNo:vm.alPaperElementList.length+1,
                                                                // 主观
                                                                content:'',
                                                                howTo:'',
                                                                correctResponse:'',
                                                                itemId:'',
                                                                itpType:'ZHUGUAN',
                                                                objectId:'',
                                                                objectStr:'',
                                                                publishStatus:'0',
                                                                score:'1',
                                                                // targetId是itpId
                                                                targetId:'',

                                                            });
                             },
                             // 添加填空
                             addTianKong:function () {
                                 vm.alPaperElementList.push({
                                                                elementId:'',
                                                                elementType:'ITP',
                                                                paperId:vm.alPaperElementVO.paperId,
                                                                seqNo:vm.alPaperElementList.length+1,
                                                                // 填空用
                                                                content:'',
                                                                howTo:'',
                                                                itemId:'',
                                                                itpType:'TIANKONG',
                                                                objectId:'',
                                                                objectStr:'',
                                                                publishStatus:'0',
                                                                score:'1',
                                                                seqNoSure:'1',
                                                                // targetId是itpId
                                                                targetId:'',
                                                                // 答案
                                                                answer:[],

                                                            });
                             },
                             // 删除某个试卷元素
                             deleteElement:function(index,alPaperElement){
                                 if(alPaperElement.elementId == ''){
                                     vm.alPaperElementList.splice(index, 1);
                                 }else{
                                     var obj = {};
                                     obj.elementId = alPaperElement.elementId;
                                     $.ajax({
                                                type : "post",
                                                url : projectName + "/engin/alPaperElement/delete",
                                                data : JSON.stringify(obj),
                                                datatype : 'json',
                                                contentType:"application/json",
                                                async: false,
                                                success : function(data) {
                                                    //console.log(JSON.stringify(data))
                                                    if(data.success == true){
                                                        // 删除
                                                        vm.alPaperElementList.splice(index, 1);
                                                        $.dialog.alert(data.message,function(){});
                                                    }else{
                                                        $.dialog.alert(data.message,function(){});
                                                    }
                                                },
                                                error : function() {
                                                    $.dialog.alert('请求失败！',function(){});
                                                }
                                            });
                                 }
                             },
                             // 引入目标
                             addObjectId:function(alPaperElement,index){
                                 bindIndex = index;
                                 bindObjectId = alPaperElement.objectId;
                                 bindObjectStr = alPaperElement.objectStr;
                                 bindKcStr = alPaperElement.kcStr;
                                 api = $.dialog({id:'addObject',
                                                    title:'查看目标',
                                                    lock: true,
                                                    background: '#FFF', /* 背景色 默认的遮罩背景色为:#DCE2F1浅蓝护眼色 */
                                                    opacity: 0.5,       /* 透明度 */
                                                    // content: 'url:alObjParent_add',
                                                    max: false,
                                                    min: false,
                                                    drag: false,
                                                    resize: false,
                                                    zIndex:50,
                                                    width:750,
                                                    height: 400,
                                                    close:function(){
                                                        // 刷新当前页面

                                                    }
                                                });
                                 /* jQuery ajax */
                                 $.ajax({
                                            url:'bindObject_list.html',
                                            success:function(data){
                                                api.content(data);
                                            },
                                            cache:false
                                        });


                             },

                             // 高级编辑模式
                             openUmeditor:function (obj,type) {
                                 if(type == 'elementDesc'){
                                     // 段落描述
                                     umeditorText = obj.elementDesc;
                                 }else if(type == 'correctResponse'){
                                     // 应用正确答案
                                     // 填空正确答案
                                     umeditorText = obj.correctResponse;
                                 }else if(type == 'howTo'){
                                     // 解析
                                     umeditorText = obj.howTo;
                                 }else if(type == 'content'){
                                     // 题干
                                     // 选择答案
                                     umeditorText = obj.content;
                                 }

                                 api = $.dialog({id:'umeditor',
                                                    title:'高级编辑模式',
                                                    lock: true,
                                                    background: '#FFF', /* 背景色 默认的遮罩背景色为:#DCE2F1浅蓝护眼色 */
                                                    opacity: 0.5,       /* 透明度 */
                                                    // content: 'url:alObjParent_add',
                                                    max: false,
                                                    min: false,
                                                    drag: false,
                                                    resize: false,
                                                    zIndex:50,
                                                    width:750,
                                                    height: 400,
                                                    close:function(){
                                                        // 重新赋值
                                                        if(type == 'elementDesc'){
                                                            // 段落描述
                                                            obj.elementDesc = umeditorText;
                                                        }else if(type == 'correctResponse'){
                                                            // 应用正确答案
                                                            // 填空正确答案
                                                            obj.correctResponse = umeditorText;
                                                        }else if(type == 'howTo'){
                                                            // 解析
                                                            obj.howTo = umeditorText;
                                                        }else if(type == 'content'){
                                                            // 题干
                                                            // 选择答案
                                                            obj.content = umeditorText;
                                                        }
                                                        mathAll();

                                                    }
                                                });
                                 /* jQuery ajax */
                                 $.ajax({
                                            url:'umeditor.html',
                                            success:function(data){
                                                api.content(data);
                                            },
                                            cache:false
                                        });


                             },
                             openUpload:function (obj) {
                                 console.log("1");
                                 api = $.dialog({id:'upload',
                                                    title:'附件',
                                                    lock: true,
                                                    background: '#FFF', /* 背景色 默认的遮罩背景色为:#DCE2F1浅蓝护眼色 */
                                                    opacity: 0.5,       /* 透明度 */
                                                    // content: 'url:alObjParent_add',
                                                    max: false,
                                                    min: false,
                                                    drag: false,
                                                    resize: false,
                                                    zIndex:50,
                                                    width:750,
                                                    height: 400,
                                                    close:function(){


                                                    }
                                                });
                                 /* jQuery ajax */
                                 $.ajax({
                                            url:'upload.html',
                                            success:function(data){
                                                api.content(data);
                                            },
                                            cache:false
                                        });
                             }

                         }
                     });

    // 弹窗以及绑定数据用
    var api = "";

    var bindIndex = '';
    var bindObjectId = '';
    var bindObjectStr = '';
    var bindKcStr = '';
    var umeditorText = '';

    // 数学公式用
    var MQ = MathQuill.getInterface(2);
    function mathAll(){
        setTimeout(function() {
            console.log("1");
            var mathC = $('.mathquill-embedded-latex');
            console.log(mathC);
            for(var i=0;i<mathC.length;i++){
                MQ.StaticMath(mathC[i]);
            }
        },1)

    }

    $(function(){
        // vm.listAlItp();
        vm.paperVo = paperItme;
        vm.alPaperElementVO.paperId = vm.paperVo.paperId;
        vm.list();
        mathAll();
    });



    // 返回
    function back() {
        if(paperType != 'paperType.DANYUAN'){
            changeList();
        }else{
            var node = treeObj.getNodeByParam("code", danyuan.bcCode);
            treeObj.selectNode(node);
            treeObj.setting.callback.onClick(null, treeObj.setting.treeId, node);
        }
    }


    // ----------------------------------------排序---------------------------------
    var fixHelperModified = function(e, tr) {
            var $originals = tr.children();
            var $helper = tr.clone();
            $helper.children().each(function(index) {
                $(this).width($originals.eq(index).width())
            });
            return $helper;
        },
        updateIndex = function(e, ui) {
            $('td.index', ui.item.parent()).each(function (i) {
                $(this).html(i + 1);
            });
        };
    $("#sort").sortable({
                            handle: ".mdui-icon", //还有这个class类点中了才能拖移
                            opacity: 0.6,                       //拖动时，透明度为0.6
                            revert: true,
                            axis:'y', // 只能y轴移动
                            delay:100,// 按住100ms后才能使用，防止误触
                        }).disableSelection();

    /**
     * 数组元素交换位置
     * @param {array} arr 数组
     * @param {number} index1 添加项目的位置
     * @param {number} index2 删除项目的位置
     * index1和index2分别是两个数组的索引值，即是两个要交换元素位置的索引值，如1，5就是数组中下标为1和5的两个元素交换位置
     */
    function swapArray(arr, index1, index2) {
        arr[index1] = arr.splice(index2, 1, arr[index1])[0];
        // versionSortTableRowClick(arr[index2],index2)
        return arr;
    }

    //上移将当前数组index索引与后面一个元素互换位置，向数组后面移动一位
    function zIndexDown(arr,index,length){
        if(index+1 != length){
            swapArray(arr, index, index+1);
        }else{
            alert('已经处于置底，无法下移');
        }
    }

    //下移将当前数组index索引与前面一个元素互换位置，向数组前面移动一位
    function zIndexUp(arr,index,length){
        if(index!= 0){
            swapArray(arr, index, index-1);
        }else{
            alert('已经处于置顶，无法上移');
        }
    }

    //数组元素移动
    function sortArray(arr,index,tindex){
        //如果当前元素在拖动目标位置的下方，先将当前元素从数组拿出，数组长度-1，我们直接给数组拖动目标位置的地方新增一个和当前元素值一样的元素，
        //我们再把数组之前的那个拖动的元素删除掉，所以要len+1
        if(index>tindex){
            arr.splice(tindex,0,arr[index]);
            arr.splice(index+1,1)
        }
        else{
            //如果当前元素在拖动目标位置的上方，先将当前元素从数组拿出，数组长度-1，我们直接给数组拖动目标位置+1的地方新增一个和当前元素值一样的元素，
            //这时，数组len不变，我们再把数组之前的那个拖动的元素删除掉，下标还是index
            arr.splice(tindex+1,0,arr[index]);
            arr.splice(index,1)
        }
        return arr;
    }

    // ----------------------------------------排序---------------------------------

    // 获取排序后的id
    function getElementIdSort() {
        // 获取id
        var resVIds = "";
        $("#sort").find("div").each(function(){
            var resVId = $(this).attr("elementid");
            if(resVId != undefined){
                resVIds = resVIds + resVId + ",";
            }
        });
        console.log(resVIds);
    }



    // 对vue的List进行重新排序
    function sortVueList(){
        var idMap = [];
        var sortList = [];
        var idsList = [];

        // 获取id
        var resVIds = "";
        $("#sort").find("div").each(function(){
            var resVId = $(this).attr("elementid");
            if(resVId != undefined){
                resVIds = resVIds + resVId + ",";
            }
        });
        resVIds = resVIds.substr(0,resVIds.length-1);
        idsList = resVIds.split(",");
        console.log(idsList);


        // 先把list根据id放入map

        for(var i = 0; i < vm.alPaperElementList.length; i++){
            idMap[vm.alPaperElementList[i].elementId] = vm.alPaperElementList[i];
        }
        console.log(idMap);

        // 循环排序放入新的list
        for(var i = 0; i < idsList.length; i++){
            vm.alPaperElementList.splice(0,1)
        }

        // pushList();
        setTimeout(function() {
            for(var i = 0; i < idsList.length; i++){
                vm.alPaperElementList.push(idMap[idsList[i]]);
            }
        },1)



    }



</script>